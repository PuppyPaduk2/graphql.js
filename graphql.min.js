!function(){function a(){var b={},c=!1,d=0,e=arguments.length;"[object Boolean]"==Object.prototype.toString.call(arguments[0])&&(c=arguments[0],d++);for(var f=function(d){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(c&&"[object Object]"==Object.prototype.toString.call(d[e])?b[e]=a(!0,b[e],d[e]):b[e]=d[e])};e>d;d++){var g=arguments[d];f(g)}return b}function b(a,b,c,d,e){var f=new XMLHttpRequest;f.open(a,b,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.setRequestHeader("Accept","application/json");for(var g in c)f.setRequestHeader(g,c[g]);f.onerror=function(){e(f,f.status)},f.onload=function(){e(JSON.parse(f.responseText),f.status)},f.send("query="+escape(d.query)+"&variables="+escape(JSON.stringify(d.variables)))}function c(a,b){b||(b={}),b.fragments||(b.fragments={}),this.options=b,this._fragments=this.buildFragments(b.fragments),this._sender=this.createSenderFunction(a),this.createHelpers(this._sender)}c.FRAGMENT_SEPERATOR="_",c.AUTOTYPE_PATTERN=/\(@autotype\)/,c.prototype.flatten=function(a){var b,d=arguments[1]||"",e=arguments[2]||{};for(b in a)a.hasOwnProperty(b)&&("object"==typeof a[b]?this.flatten(a[b],d+b+c.FRAGMENT_SEPERATOR,e):e[d+b]=a[b]);return e},c.prototype.fragmentPath=function(a,b){var d=new Function("fragments","return fragments."+b.replace(/\./g,c.FRAGMENT_SEPERATOR)),e=d(a);if(!e||"string"!=typeof e)throw"Fragment "+b+" not found";return e},c.prototype.processQuery=function(a,b){var d=this,e=/\.\.\.\s*([A-Za-z0-9\.]+)/g,f=(a.match(e)||[]).map(function(a){var c=a.replace(e,function(a,b){return b});return d.fragmentPath(b,c)});return a=a.replace(e,function(a,b){return"..."+b.split(".").join(c.FRAGMENT_SEPERATOR)}),[a].concat(f).join("\n")},c.prototype.autoType=function(a,b){var d={string:"String",number:"Int","boolean":"Boolean"};return a.replace(c.AUTOTYPE_PATTERN,function(){var a=[];for(var c in b){var e=b[c],f=c.split("!"),g=f[1]||d[typeof e];g&&a.push("$"+f[0]+": "+g+"!")}return a=a.join(", "),"("+a+")"})},c.prototype.cleanAutoTypeAnnotations=function(a){a||(a={});var b={};for(var c in a){var d=a[c],e=c.split("!");b[e[0]]=d}return b},c.prototype.buildFragments=function(a){var b=this;a=this.flatten(a||{});var c={};for(var d in a){var e=a[d];"object"==typeof e?c[d]=b.buildFragments(e):c[d]="\nfragment "+d+" "+e}return c},c.prototype.buildQuery=function(a,b){return this.autoType(this.processQuery(a,this._fragments,b),b)},c.prototype.createSenderFunction=function(c){var d=this;return function(e){var f=function(f,g){g||(g={}),f||(f={});var h=d.buildQuery(e,f);return headers=a(d.options.headers||{},g.headers||{}),new Promise(function(a,e){b(d.options.method||"post",c,headers,{query:h,variables:d.cleanAutoTypeAnnotations(f)},function(b,c){200==c?b.errors?e(b.errors):b.data&&a(b.data):e(b)})})};return arguments.length>1?f.apply(null,Array.prototype.slice.call(arguments,1)):f}},c.prototype.createHelpers=function(b){function c(a){var c=b(this.prefix+" "+a);return arguments.length>1?c.apply(null,Array.prototype.slice.call(arguments,1)):c}var d=this;this.mutate=c.bind({prefix:"mutation"}),this.query=c.bind({prefix:"query"}),this.subscription=c.bind({prefix:"subscription"}),this.fragment=function(b){return d.options.fragments=a(!0,d.options.fragments,b),d._fragments=d.buildFragments(d.options.fragments),d._fragments};var e=["mutate","query","subscription"];e.forEach(function(a){d[a].run=function(b){return d[a](b,{})}}),this.run=function(a){return b(a,{})}},function(a,b){"function"==typeof define&&define.amd?define(function(){return a.GraphQLClient=b(c)}):"object"==typeof module&&module.exports?module.exports=b(a.GraphQLClient):a.GraphQLClient=b(a.GraphQLClient)}(this,function(){return c})}();